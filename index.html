<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MC3 AUTO PARTS — Inventory</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
    body{background:#0d1117;color:white;font-family:Arial;margin:0;padding:20px;}
    h1{text-align:center;margin-bottom:5px;}
    h2{text-align:center;margin-top:0;color:#00d27a;}
    input,select{padding:7px;border-radius:5px;border:none;margin:5px;}
    button{padding:7px 12px;border-radius:5px;border:none;cursor:pointer;margin:5px;font-weight:bold;}
    #addBtn{background:#007bff;color:white;}
    #saveBtn{background:#28a745;color:white;}
    #exportBtn{background:#9b59b6;color:white;}
    #importBtn{background:#f1c40f;}
    #adminBtn{background:#e67e22;color:white;}
    table{width:100%;border-collapse:collapse;margin-top:20px;}
    th,td{border-bottom:1px solid #444;padding:8px;text-align:left;}
    th{background:#111;}
    tr:hover{background:#222;}
    #totalStockBox{color:#00d27a;font-size:18px;font-weight:bold;margin-left:auto;}
    .toolbar{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
</style>
</head>
<body>

<h1>MC3 AUTO PARTS</h1>
<h2>Inventory System • Editable • Auto-Save</h2>

<!-- TOOLBAR -->
<div class="toolbar">
    <input id="search" placeholder="Search Code, Brand, Model, Type…" style="flex:1">
    <select id="filterType">
        <option value="">All Types</option>
        <option value="AIR">AIR</option>
        <option value="CABIN">CABIN</option>
        <option value="OIL">OIL</option>
    </select>
    <select id="sortBy">
        <option value="">Sort: None</option>
        <option value="brand">Brand (A–Z)</option>
        <option value="type">Type</option>
        <option value="code">Code</option>
        <option value="stock_desc">Stock (High→Low)</option>
    </select>
    <button id="addBtn">ADD ITEM</button>
    <button id="saveBtn">SAVE CHANGES</button>
    <button id="exportBtn">Export XLSX</button>
    <button id="importBtn">Import XLSX</button>

    <!-- TOTAL STOCK HERE -->
    <div id="totalStockBox">Total Stock: 0</div>
</div>

<input type="file" id="fileImport" style="display:none">

<table>
<thead>
<tr>
    <th>Code</th>
    <th>Type</th>
    <th>Brand</th>
    <th>Fitment</th>
    <th>Stock</th>
    <th>Retail ₱</th>
    <th>Wholesale ₱</th>
    <th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
let inventory = JSON.parse(localStorage.getItem("mc3_inventory") || "[]");

/* ---------- DEFAULT EMPTY FALLBACK ---------- */
if(!Array.isArray(inventory)) inventory = [];

/* ---------- SAVE TO LOCAL ---------- */
function save() {
    localStorage.setItem("mc3_inventory", JSON.stringify(inventory));
    alert("Saved!");
}

/* ---------- RENDER INVENTORY ---------- */
function render() {
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    const q = document.getElementById("search").value.trim().toLowerCase();
    const fType = document.getElementById("filterType").value;
    const sortBy = document.getElementById("sortBy").value;

    let items = inventory.filter(it => {
        if (fType && it.type !== fType) return false;
        if (!q) return true;
        return (
            it.code.toLowerCase().includes(q) ||
            it.brand.toLowerCase().includes(q) ||
            it.fitment.toLowerCase().includes(q) ||
            it.type.toLowerCase().includes(q)
        );
    });

    // SORTING
    if (sortBy === "brand") items.sort((a,b)=>a.brand.localeCompare(b.brand));
    if (sortBy === "type") items.sort((a,b)=>a.type.localeCompare(b.type));
    if (sortBy === "code") items.sort((a,b)=>a.code.localeCompare(b.code));
    if (sortBy === "stock_desc") items.sort((a,b)=>Number(b.stock)-Number(a.stock));

    // CREATE ROWS
    items.forEach((it,idx)=>{
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td contenteditable oninput="edit(${idx},'code',this.innerText)">${it.code}</td>
            <td contenteditable oninput="edit(${idx},'type',this.innerText)">${it.type}</td>
            <td contenteditable oninput="edit(${idx},'brand',this.innerText)">${it.brand}</td>
            <td contenteditable oninput="edit(${idx},'fitment',this.innerText)">${it.fitment}</td>
            <td contenteditable oninput="edit(${idx},'stock',this.innerText)">${it.stock}</td>
            <td contenteditable oninput="edit(${idx},'retail',this.innerText)">${it.retail}</td>
            <td contenteditable oninput="edit(${idx},'wholesale',this.innerText)">${it.wholesale}</td>
            <td><button onclick="del(${idx})" style="background:red;color:white">X</button></td>
        `;
        tbody.appendChild(tr);
    });

    // ---- UPDATE TOTAL STOCK ----
    let total = 0;
    items.forEach(it => total += Number(it.stock) || 0);
    document.getElementById("totalStockBox").innerText = "Total Stock: " + total;
}

/* ---------- EDIT ITEM ---------- */
function edit(i, field, value) {
    inventory[i][field] = value;
}

/* ---------- DELETE ITEM ---------- */
function del(i) {
    if(!confirm("Delete this item?")) return;
    inventory.splice(i,1);
    save();
    render();
}

/* ---------- ADD ITEM ---------- */
document.getElementById("addBtn").onclick = ()=>{
    inventory.push({
        code:"NEW",
        type:"",
        brand:"",
        fitment:"",
        stock:0,
        retail:0,
        wholesale:0
    });
    render();
};

/* ---------- SAVE BUTTON ---------- */
document.getElementById("saveBtn").onclick = save;

/* ---------- SEARCH LISTENER ---------- */
document.getElementById("search").oninput = render;

/* ---------- FILTER LISTENERS ---------- */
document.getElementById("filterType").onchange = render;
document.getElementById("sortBy").onchange = render;

/* ---------- EXPORT XLSX ---------- */
document.getElementById("exportBtn").onclick = ()=>{
    const ws = XLSX.utils.json_to_sheet(inventory);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Inventory");
    XLSX.writeFile(wb, "MC3_Inventory.xlsx");
};

/* ---------- IMPORT XLSX ---------- */
document.getElementById("importBtn").onclick = ()=>{
    document.getElementById("fileImport").click();
};

document.getElementById("fileImport").onchange = (e)=>{
    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = (ev)=>{
        const data = new Uint8Array(ev.target.result);
        const wb = XLSX.read(data, {type:"array"});
        const ws = wb.Sheets[wb.SheetNames[0]];
        inventory = XLSX.utils.sheet_to_json(ws);
        save();
        render();
    };
    reader.readAsArrayBuffer(file);
};

/* ---------- INITIAL RENDER ---------- */
render();
</script>
</body>
</html>
